{
   "AWSTemplateFormatVersion" : "2010-09-09",
   "Description" : "Conjur Instance",
   "Resources" : {
      "ConjurInstance" : {
         "Type" : "AWS::EC2::Instance",
         "Properties" : {
            "ImageId" : "ami-597f5725",
            "KeyName" : "capichet-aws-keypair",
            "Tags": [
                {
                    "Key": "Name",
                    "Value": "ConjurMaster"
                }
            ],
            "SecurityGroupIds": [ "sg-c872a7b0" ],
            "SubnetId": "subnet-4190fc37",
            "InstanceType": "t2.small",
            "UserData": {"Fn::Base64": {"Fn::Join":["", [
    "#!/bin/bash\n",
    "hostname=conjur.cyberark-demo.com\n",
    "password=Cyberark1\n",
    "orgaccount=mydemo\n",
    "docker exec conjur-appliance evoke configure master -h $hostname -p $password $orgaccount\n"
            ]]}}
         }

      },
      "ConjurDNSRecord" : {
          "Type" : "AWS::Route53::RecordSet",
          "Properties" : {
             "HostedZoneName" : "cyberark-demo.com.",
             "Comment" : "Auto update from CFN",
             "Name" : "conjur.cyberark-demo.com",
             "TTL" : "120",
             "Type" : "A",
             "ResourceRecords" : [
                { "Fn::GetAtt" : [ "ConjurInstance", "PublicIp" ] }
             ]
          }
      }

   }
}
